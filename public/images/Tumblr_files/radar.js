(function(c,b){var a=Backbone.View.extend({el:"#tumblr_radar",events:{"click .follow":"toggleFollow","click .reblog":"reblog","click .like:not(.liked)":"like","click .liked":"unlike"},initialize:function(){this.post_id=this.$el.attr("data-post-id");this.tumblelog=this.$el.attr("data-tumblelog");this.form_key=c("#tumblr_form_key").attr("content");this.placement_id=this.$el.attr("data-placement-id");this.tumblelogModel=new Tumblr.Models.Tumblelog({name:this.$el.attr("data-tumblelog"),following:(this.$el.attr("data-following-tumblelog")==="1"),ignoring:false,radared:true});this.listenTo(this.tumblelogModel,"change:following",this.renderFollow);this.$followButton=this.$(".follow");this.version=this.$el.hasClass("radar_v2")?"v2":"v1";if(this.version==="v2"&&this.$el.hasClass("radar_type_video")){var d=this.$el.find(".thumbnail_anchor");var j=c.parseJSON(c(d).attr("data-thumbnail-urls"));var h=[];for(var g=0;g<j.length;g++){h.push({photo_url:j[g]})}var f=new Tumblr.NerdSlideshow({slideshow_container:d,slideshow_items:h,display_badge:false,display_like_and_reblog:false})}else{if(this.version==="v2"&&this.$el.find(".photoset").length>0){var e=this.$el.find(".photoset");var j=c.parseJSON(c(e).attr("data-thumbnail-urls"));var f=new Tumblr.RadarPhotosetSlideshow({container:e,image_urls:j})}}},renderFollow:function(d,e){if(d._previousAttributes.following==null||d._previousAttributes.following===e){return}if(this.version==="v2"){this.$followButton[e?"hide":"show"]()}else{if(this.version==="v1"){this.$followButton.toggleClass("followed",e)}}},toggleFollow:function(){this.tumblelogModel.save_following({following:!this.tumblelogModel.get("following")},{placement_id:this.placement_id,source:!this.tumblelogModel.get("following")?"FOLLOW_SOURCE_RADAR":"UNFOLLOW_SOURCE_RADAR"}).fail(function(){alert(l10n_str.ajax_error)});return false},like:function(e){e.stopPropagation();e.preventDefault();var d=c(e.currentTarget);d.addClass("liked");Tumblr.like({id:this.post_id,key:d.attr("data-reblog-key"),placement_id:this.placement_id,source:"LIKE_SOURCE_RADAR"},{error:function(){d.removeClass("liked");alert(l10n_str.ajax_error)}})},unlike:function(e){e.stopPropagation();e.preventDefault();var d=c(e.currentTarget);d.removeClass("liked");Tumblr.unlike({id:this.post_id,key:d.attr("data-reblog-key"),placement_id:this.placement_id,source:"UNLIKE_SOURCE_RADAR"},{error:function(){d.addClass("liked");alert(l10n_str.ajax_error)}})},reblog:function(e){if(e.altKey){e.stopPropagation();e.preventDefault();var d=c(e.currentTarget);if(d.hasClass("reblogged")){return}d.addClass("reblogged");c.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:d.attr("data-reblog-key"),reblog_post_id:d.attr("data-reblog-id"),form_key:this.form_key},error:function(){d.removeClass("reblogged");alert(l10n_str.ajax_error)}})}}});b.Radar=a})(jQuery,Tumblr);jQuery(document).ready(function(a){new Tumblr.Radar()});